
\begin{figure}[ht]
\hrule\hrule
\centering
  \begin{slangmath}[numbers=left,emph={MergeModels, MkMap, MkModel,%
                    MergeData, MergeComp, MergeOp, MapSum}]
function MergeModels($m_1, m_2, (r_c,r_O,r_D)$)
 let $h_D=$ map($r_D$, \lambda$D_1,D_2 \cdot$($D_1$, MergeData($D_1, D_2$)))
 let $h_C=$ map($r_C$, \lambda$C_1,C_2 \cdot$($C_1$, MergeComp($C_1, C_2$)))
 MkModel($m_1, m_2, h_C, h_D$)

function MkModel($m_1, m_2, h_C, h_D$)
 let $f_{map} = \lambda h,e \cdot (e \in h) \;?\; \{h(e)\} : \{e\}$
 let $C' =\; $MapSum($m_1.comps \cup m_2.comps,\; f_{map}(h_C)$)
 let $D' =\; $MapSum($m_1.data \cup m_2.data,\; f_{map}(h_D)$)
 ($C', D'$)

function MergeData($D_1, D_2$)
 MkEmbeddingFunc($D_1, D_2$)($D_1$)
 
function MergeOp($O_1, O_2$)
 let $O'=\; $MkEmbeddingFunc($O_1, O_2$)($O_1$)
 let $O'.args= O_1.args \cup O_2.args$ 
 $O'$

function MergeComp($c_1, c_2, r_O$)
 let $f_{map} = \lambda O_1,O_2 \cdot (O_1,O_2)\in r_O\;?\;$MergeOp($O_1,O_2$)$\;: O_1$
 let $e = c_2.exports\;\cup\;$MapSum($c_1.exports \times c_2.exports, f_{map}$)
 let $i = c_2.invokes\;\cup\;$MapSum($c_1.invokes \times c_2.invokes, f_{map}$)
 let $s, g = c_1.stores \cup c_2.stores,\; c_1.guard \cup c_2.guard$
 $(e, i, s, g)$

function MapSum($lst, f_{map}$)
 fold($\{\}, f_{map}(lst), \lambda a, e \cdot a \cup e$)
  \end{slangmath}
\hrule\vskip7pt
\caption{Merging algorithm.\label{fig-mergingin-alg-func}}
\end{figure}
